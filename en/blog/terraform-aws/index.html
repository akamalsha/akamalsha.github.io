<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Terraform AWS Infrastructure | Adil Kamalsha&#39;s Blog</title>
<meta name="keywords" content="Cloud, Automation">
<meta name="description" content="In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)
I use Visual Studio Code to build my terraform code.
The directory structure looks like this


This code is also uploaded in my github repo https://github.com/akamalsha/terraform-aws-code
Feel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure.">
<meta name="author" content="Adil">
<link rel="canonical" href="https://akamalsha.github.io/en/blog/terraform-aws/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css" integrity="sha256-xd5zT72Iw9IVQ0hf&#43;8sczdqJqGp4DPmH&#43;gAZnEHbyUc=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://akamalsha.github.io/k-48.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://akamalsha.github.io/k-48.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://akamalsha.github.io/k-48.png">
<link rel="apple-touch-icon" href="https://akamalsha.github.io/k-48.png">
<link rel="mask-icon" href="https://akamalsha.github.io/k-48.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://akamalsha.github.io/en/blog/terraform-aws/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Terraform AWS Infrastructure" />
<meta property="og:description" content="In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)
I use Visual Studio Code to build my terraform code.
The directory structure looks like this


This code is also uploaded in my github repo https://github.com/akamalsha/terraform-aws-code
Feel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://akamalsha.github.io/en/blog/terraform-aws/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-01-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-01T00:00:00+00:00" /><meta property="og:site_name" content="Adil" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Terraform AWS Infrastructure"/>
<meta name="twitter:description" content="In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)
I use Visual Studio Code to build my terraform code.
The directory structure looks like this


This code is also uploaded in my github repo https://github.com/akamalsha/terraform-aws-code
Feel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://akamalsha.github.io/en/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Terraform AWS Infrastructure",
      "item": "https://akamalsha.github.io/en/blog/terraform-aws/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Terraform AWS Infrastructure",
  "name": "Terraform AWS Infrastructure",
  "description": "In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)\nI use Visual Studio Code to build my terraform code.\nThe directory structure looks like this This code is also uploaded in my github repo https://github.com/akamalsha/terraform-aws-code\nFeel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure.\n",
  "keywords": [
    "Cloud", "Automation"
  ],
  "articleBody": "In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)\nI use Visual Studio Code to build my terraform code.\nThe directory structure looks like this This code is also uploaded in my github repo https://github.com/akamalsha/terraform-aws-code\nFeel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure.\nvariables.tf code variable \"aws_region\" { default = \"us-west-2\" } variable \"prod_environment\" { default = \"prod-hub\" } variable \"spoke_01_environmet\" { default = \"spoke-01\" } variable \"spoke_02_environmet\" { default = \"spoke-02\" } variable \"prod_hub_vpc_cidr\" { default = \"10.13.0.0/24\" description = \"prod-hub\" } variable \"spoke_01_vpc_cidr\" { default = \"10.14.0.0/24\" description = \"spoke-01\" } variable \"spoke_02_vpc_cidr\" { default = \"10.15.0.0/24\" description = \"spoke-02\" } variable \"prod_public_subnets_cidr\" { type = list(any) default = [\"10.13.0.112/28\"] description = \"prod-hub-public-subnet\" } variable \"prod_hub_private_subnets_cidr\" { type = list(any) default = [\"10.13.0.64/28\"] description = \"prod-hub-private-subnet\" } variable \"spoke_01_private_subnets_cidr\" { type = list(any) default = [\"10.14.0.64/28\"] description = \"spoke-01-private-subnet\" } variable \"spoke_02_private_subnets_cidr\" { type = list(any) default = [\"10.15.0.64/28\"] description = \"spoke-02-private-subnet\" } variable \"availability_zone\" { type = list default = [\"us-west-2a\", \"us-west-2b\"] } main.tf code terraform { required_providers { aws = { source = \"hashicorp/aws\" version = \"~\u003e 4.16\" } } required_version = \"\u003e= 1.2.0\" } provider \"aws\" { region = var.aws_region } #VPC_Prod_Hub resource \"aws_vpc\" \"prod_hub\" { cidr_block = var.prod_hub_vpc_cidr enable_dns_support = true enable_dns_hostnames = true tags = { Name = \"${var.prod_environment}-vpc\" \"Environment\" = var.prod_environment } } #VPC_Spoke_01 resource \"aws_vpc\" \"spoke-01\" { cidr_block = var.spoke_01_vpc_cidr enable_dns_support = true enable_dns_hostnames = true tags = { \"Name\" = \"${var.spoke_01_environmet}-vpc\" \"Environment\" = var.spoke_01_environmet } } #VPC_Spoke_02 resource \"aws_vpc\" \"spoke-02\" { cidr_block = var.spoke_02_vpc_cidr enable_dns_support = true enable_dns_hostnames = true tags = { \"Name\" = \"${var.spoke_02_environmet}-vpc\" \"Environment\" = var.spoke_02_environmet } } #Prod-hub Public Subnet resource \"aws_subnet\" \"prod-hub-pub\" { vpc_id = aws_vpc.prod_hub.id count = length(var.prod_public_subnets_cidr) cidr_block = element (var.prod_public_subnets_cidr, count.index) availability_zone = var.availability_zone[0] map_public_ip_on_launch = true } #Prod-hub Private Subnet resource \"aws_subnet\" \"prod-hub-private\" { vpc_id = aws_vpc.prod_hub.id count = length(var.prod_hub_private_subnets_cidr) cidr_block = element (var.prod_hub_private_subnets_cidr, count.index) availability_zone = var.availability_zone[0] map_public_ip_on_launch = false } #Spoke-01 Private Subnet resource \"aws_subnet\" \"spoke-01-private\" { vpc_id = aws_vpc.spoke-01.id count = length(var.spoke_01_private_subnets_cidr) cidr_block = element (var.spoke_01_private_subnets_cidr, count.index) availability_zone = var.availability_zone[0] map_public_ip_on_launch = false } #Spoke-02 Private Subnet resource \"aws_subnet\" \"spoke-02-private\" { vpc_id = aws_vpc.spoke-02.id count = length(var.spoke_02_private_subnets_cidr) cidr_block = element (var.spoke_02_private_subnets_cidr, count.index) availability_zone = var.availability_zone[0] map_public_ip_on_launch = false } #IGW Prod-hub resource \"aws_internet_gateway\" \"IGW_ProdHub\" { vpc_id =aws_vpc.prod_hub.id tags = { \"Name\" = \"$var.prod_environment-igw\" \"Environment\" = var.prod_environment } } # Elastic-IP (eip) for NAT- ProdHub resource \"aws_eip\" \"nat_eip\" { vpc = true depends_on = [aws_internet_gateway.IGW_ProdHub] } # NAT Gateway in Prod-hub resource \"aws_nat_gateway\" \"Prod_HubNAT\" { allocation_id = aws_eip.nat_eip.id subnet_id = element(aws_subnet.prod-hub-pub.*.id, 0) tags = { Name = \"nat-gateway-${var.prod_environment}\" Environment = \"${var.prod_environment}\" } } #Transit Gateway for Prod-Hub Egress VPC resource \"aws_ec2_transit_gateway\" \"ProdHub_EgressTGW\" { description = \"TGW to connect to Spoke VPC\" default_route_table_association = \"disable\" default_route_table_propagation = \"disable\" } #Create TGW Route Tables resource \"aws_ec2_transit_gateway_route_table\" \"RT-Egrees\" { transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } resource \"aws_ec2_transit_gateway_route_table\" \"RT-Private\" { transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } #Create TGW attachment for Prod-Hub VPC resource \"aws_ec2_transit_gateway_vpc_attachment\" \"prod-hub\" { transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id vpc_id = aws_vpc.prod_hub.id subnet_ids = [aws_subnet.prod-hub-private[0].id] transit_gateway_default_route_table_association = false transit_gateway_default_route_table_propagation = false } #Create TGW attachment for Spoke-01 VPC resource \"aws_ec2_transit_gateway_vpc_attachment\" \"spoke-01\" { transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id vpc_id = aws_vpc.spoke-01.id subnet_ids = [aws_subnet.spoke-01-private[0].id] transit_gateway_default_route_table_association = false transit_gateway_default_route_table_propagation = false } #Create TGW attachment for Spoke-02 VPC resource \"aws_ec2_transit_gateway_vpc_attachment\" \"spoke-02\" { transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id vpc_id = aws_vpc.spoke-02.id subnet_ids = [aws_subnet.spoke-02-private[0].id] transit_gateway_default_route_table_association = false transit_gateway_default_route_table_propagation = false } # Routing tables to route traffic for Public Subnet in Prod-Hub resource \"aws_route_table\" \"prod-hub-public\" { vpc_id = aws_vpc.prod_hub.id tags = { Name = \"${var.prod_environment}-public-route-table\" Environment = \"${var.prod_environment}\" } } # Routing tables to route traffic for Private Subnet- Prod Hub resource \"aws_route_table\" \"prod-hub-private\" { vpc_id = aws_vpc.prod_hub.id tags = { Name = \"${var.prod_environment}-private-route-table\" Environment = \"${var.prod_environment}\" } } # Routing tables to route traffic for Private Subnet- Spoke-01 resource \"aws_route_table\" \"spoke-01-private\" { vpc_id = aws_vpc.spoke-01.id tags = { Name = \"${var.spoke_01_environmet}-private-route-table\" Environment = \"${var.spoke_01_environmet}\" } } # Routing tables to route traffic for Private Subnet- Spoke-02 resource \"aws_route_table\" \"spoke-02-private\" { vpc_id = aws_vpc.spoke-02.id tags = { Name = \"${var.spoke_02_environmet}-private-route-table\" Environment = \"${var.spoke_02_environmet}\" } } # Route for Internet Gateway in Prod-Hub resource \"aws_route\" \"public_internet_gateway\" { route_table_id = aws_route_table.prod-hub-public.id destination_cidr_block = \"0.0.0.0/0\" gateway_id = aws_internet_gateway.IGW_ProdHub.id } # Route for NAT Gateway - Prodhub resource \"aws_route\" \"private_prod_nat_gateway\" { route_table_id = aws_route_table.prod-hub-private.id destination_cidr_block = \"0.0.0.0/0\" nat_gateway_id = aws_nat_gateway.Prod_HubNAT.id } resource \"aws_route\" \"private_prod_spoke01_gateway\" { route_table_id = aws_route_table.prod-hub-private.id destination_cidr_block = \"10.14.0.0/24\" transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } resource \"aws_route\" \"private_prod_spoke02_gateway\" { route_table_id = aws_route_table.prod-hub-private.id destination_cidr_block = \"10.15.0.0/24\" transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } # Route for NAT Gateway - Spoke-01 resource \"aws_route\" \"private_spoke01_nat_gateway\" { route_table_id = aws_route_table.spoke-01-private.id destination_cidr_block = \"0.0.0.0/0\" transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } # Route for NAT Gateway - Spoke-02 resource \"aws_route\" \"private_spoke02_nat_gateway\" { route_table_id = aws_route_table.spoke-02-private.id destination_cidr_block = \"0.0.0.0/0\" transit_gateway_id = aws_ec2_transit_gateway.ProdHub_EgressTGW.id } #Route for Egress TGW resource \"aws_ec2_transit_gateway_route\" \"RT_Egress01\" { destination_cidr_block = \"10.14.0.0/24\" transit_gateway_route_table_id = aws_ec2_transit_gateway_route_table.RT-Egrees.id transit_gateway_attachment_id = aws_ec2_transit_gateway_vpc_attachment.spoke-01.id } #Route for Egress TGW resource \"aws_ec2_transit_gateway_route\" \"RT_Egress02\" { destination_cidr_block = \"10.15.0.0/24\" transit_gateway_route_table_id = aws_ec2_transit_gateway_route_table.RT-Egrees.id transit_gateway_attachment_id = aws_ec2_transit_gateway_vpc_attachment.spoke-02.id } #Route for RT-Private TGW resource \"aws_ec2_transit_gateway_route\" \"RT_Private_Blackhole\" { destination_cidr_block = \"10.15.0.0/24\" transit_gateway_route_table_id = aws_ec2_transit_gateway_route_table.RT-Private.id blackhole = true } resource \"aws_ec2_transit_gateway_route\" \"RT_PrivateSPOKE_blackhole\" { destination_cidr_block = \"10.14.0.0/24\" transit_gateway_route_table_id = aws_ec2_transit_gateway_route_table.RT-Private.id blackhole = true } resource \"aws_ec2_transit_gateway_route\" \"RT_Private_Allow\" { destination_cidr_block = \"10.13.0.0/24\" transit_gateway_route_table_id = aws_ec2_transit_gateway_route_table.RT-Private.id transit_gateway_attachment_id = aws_ec2_transit_gateway_vpc_attachment.prod-hub.id } #Create ec2 instances in Prod,Spoke-01/02 to test the egress architecture resource \"aws_instance\" \"prod-t2\" { ami = \"ami-04e914639d0cca79a\" instance_type = \"t2.micro\" subnet_id = \"${aws_subnet.prod-hub-private[0].id}\" associate_public_ip_address = \"true\" key_name = \"terraform-key\" } resource \"aws_instance\" \"spoke-01-t2\" { ami = \"ami-04e914639d0cca79a\" instance_type = \"t2.micro\" subnet_id = \"${aws_subnet.spoke-01-private[0].id}\" associate_public_ip_address = \"false\" key_name = \"terraform-key\" } resource \"aws_instance\" \"spoke-02-t2\" { ami = \"ami-04e914639d0cca79a\" instance_type = \"t2.micro\" subnet_id = \"${aws_subnet.spoke-02-private[0].id}\" associate_public_ip_address = \"false\" key_name = \"terraform-key\" } ",
  "wordCount" : "968",
  "inLanguage": "en",
  "datePublished": "2024-01-01T00:00:00Z",
  "dateModified": "2024-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Adil"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://akamalsha.github.io/en/blog/terraform-aws/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Adil Kamalsha's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://akamalsha.github.io/k-48.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://akamalsha.github.io/en/" accesskey="h" title="Home (Alt + H)">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://akamalsha.github.io/en/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://akamalsha.github.io/en/resume.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="https://akamalsha.github.io/en/blog" title="Blogs">
                    <span>Blogs</span>
                </a>
            </li>
            <li>
                <a href="https://akamalsha.github.io/en/search/" title="Search">
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://akamalsha.github.io/en/">Home</a>&nbsp;»&nbsp;<a href="https://akamalsha.github.io/en/blog/">Blogs</a></div>
    <h1 class="post-title entry-hint-parent">
      Terraform AWS Infrastructure
    </h1>
    <div class="post-meta"><span title='2024-01-01 00:00:00 +0000 UTC'>2024-01-01</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Adil
      
<span class="meta-item">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-activity"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> 
    &nbsp;
    <span id="87b77761b830e67548ed0f31932e0c9d" title="">
    </span>
</span>
<script>
    var r = new XMLHttpRequest();
    r.addEventListener('load', function() {
        document.getElementById('87b77761b830e67548ed0f31932e0c9d').innerText = JSON.parse(this.responseText).count_unique + ' ' + ""
    })
    r.open('GET', "https://akamalsha.goatcounter.com/counter/" + encodeURIComponent("/en/blog/terraform-aws/".replace(/(\/)?$/, '')) + '.json')
    r.send()
</script>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#variablestf-code" aria-label="variables.tf code">variables.tf code</a></li>
                <li>
                    <a href="#maintf-code" aria-label="main.tf code">main.tf code</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>In this post I will be sharing the terraform code to build a Centralized NAT Gateway using Transit Gateway (Route table design)</p>
<p>I use Visual Studio Code to build my terraform code.</p>
<p>The directory structure looks like this
<img loading="lazy" src="/vscode.png" alt="image alt text"  />
</p>
<p>This code is also uploaded in my github repo <a href="https://github.com/akamalsha/terraform-aws-code">https://github.com/akamalsha/terraform-aws-code</a></p>
<p>Feel free to customize the configuration according to your specific requirements and explore additional features and functionalities offered by Terraform and AWS to further optimize your network infrastructure.</p>
<h1 id="variablestf-code">variables.tf code<a hidden class="anchor" aria-hidden="true" href="#variablestf-code">#</a></h1>
<pre tabindex="0"><code class="language-terrform" data-lang="terrform">    variable &#34;aws_region&#34; {
    default = &#34;us-west-2&#34;
}
variable &#34;prod_environment&#34; {
    default = &#34;prod-hub&#34;
}
variable &#34;spoke_01_environmet&#34; {
  default = &#34;spoke-01&#34;
}
variable &#34;spoke_02_environmet&#34; {
    default = &#34;spoke-02&#34;
}
variable &#34;prod_hub_vpc_cidr&#34; {
    default = &#34;10.13.0.0/24&#34;
    description = &#34;prod-hub&#34;
}
variable &#34;spoke_01_vpc_cidr&#34; {
  default = &#34;10.14.0.0/24&#34;
  description = &#34;spoke-01&#34;
}
variable &#34;spoke_02_vpc_cidr&#34; {
    default = &#34;10.15.0.0/24&#34;
    description = &#34;spoke-02&#34;
}
variable &#34;prod_public_subnets_cidr&#34; {
    type        = list(any)
    default = [&#34;10.13.0.112/28&#34;]
    description = &#34;prod-hub-public-subnet&#34;
}
variable &#34;prod_hub_private_subnets_cidr&#34; {
    type        = list(any)
    default =  [&#34;10.13.0.64/28&#34;]   
    description = &#34;prod-hub-private-subnet&#34;
}
variable &#34;spoke_01_private_subnets_cidr&#34; {
    type        = list(any)
    default = [&#34;10.14.0.64/28&#34;]
    description = &#34;spoke-01-private-subnet&#34;
}
variable &#34;spoke_02_private_subnets_cidr&#34; {
   type        = list(any)
    default = [&#34;10.15.0.64/28&#34;]
    description = &#34;spoke-02-private-subnet&#34;
}

variable &#34;availability_zone&#34; {
    type = list
  default = [&#34;us-west-2a&#34;, &#34;us-west-2b&#34;]
}
</code></pre><h1 id="maintf-code">main.tf code<a hidden class="anchor" aria-hidden="true" href="#maintf-code">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#a6e22e">terraform</span>  {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">required_providers</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">aws</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">source</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hashicorp/aws&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;~&gt; 4.16&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">required_version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&gt;= 1.2.0&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">provider</span> <span style="color:#e6db74">&#34;aws&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">region</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">aws_region</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#VPC_Prod_Hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;prod_hub&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">prod_hub_vpc_cidr</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_support</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_hostnames</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-vpc&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Environment&#34;</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">prod_environment</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#VPC_Spoke_01
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;spoke-01&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">spoke_01_vpc_cidr</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_support</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_hostnames</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Name&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_01_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-vpc&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Environment&#34;</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">spoke_01_environmet</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#VPC_Spoke_02
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;spoke-02&#34;</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">spoke_02_vpc_cidr</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_support</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">enable_dns_hostnames</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Name&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_02_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-vpc&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Environment&#34;</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">spoke_02_environmet</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Prod-hub Public Subnet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;prod-hub-pub&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> length(var.<span style="color:#a6e22e">prod_public_subnets_cidr</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> element (var.<span style="color:#a6e22e">prod_public_subnets_cidr</span>, count.<span style="color:#a6e22e">index</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">availability_zone</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">availability_zone</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map_public_ip_on_launch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Prod-hub Private Subnet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;prod-hub-private&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> length(var.<span style="color:#a6e22e">prod_hub_private_subnets_cidr</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> element (var.<span style="color:#a6e22e">prod_hub_private_subnets_cidr</span>, count.<span style="color:#a6e22e">index</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">availability_zone</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">availability_zone</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map_public_ip_on_launch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Spoke-01 Private Subnet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;spoke-01-private&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> length(var.<span style="color:#a6e22e">spoke_01_private_subnets_cidr</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> element (var.<span style="color:#a6e22e">spoke_01_private_subnets_cidr</span>, count.<span style="color:#a6e22e">index</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">availability_zone</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">availability_zone</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map_public_ip_on_launch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Spoke-02 Private Subnet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;spoke-02-private&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>count <span style="color:#f92672">=</span> length(var.<span style="color:#a6e22e">spoke_02_private_subnets_cidr</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cidr_block</span> <span style="color:#f92672">=</span> element (var.<span style="color:#a6e22e">spoke_02_private_subnets_cidr</span>, count.<span style="color:#a6e22e">index</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">availability_zone</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">availability_zone</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">map_public_ip_on_launch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#IGW Prod-hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_internet_gateway&#34;</span> <span style="color:#e6db74">&#34;IGW_ProdHub&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span><span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Name&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#e6db74">var.prod_environment-igw&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;Environment&#34;</span> <span style="color:#f92672">=</span> var.<span style="color:#a6e22e">prod_environment</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Elastic-IP (eip) for NAT- ProdHub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_eip&#34;</span> <span style="color:#e6db74">&#34;nat_eip&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc</span>        <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">depends_on</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">aws_internet_gateway</span>.<span style="color:#a6e22e">IGW_ProdHub</span>]
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># NAT Gateway in Prod-hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_nat_gateway&#34;</span> <span style="color:#e6db74">&#34;Prod_HubNAT&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">allocation_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_eip</span>.<span style="color:#a6e22e">nat_eip</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_id</span>     <span style="color:#f92672">=</span> element(<span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">pub</span>.<span style="color:#f92672">*</span>.<span style="color:#a6e22e">id</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span>        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nat-gateway-</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Environment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Transit Gateway for Prod-Hub Egress VPC 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway&#34;</span> <span style="color:#e6db74">&#34;ProdHub_EgressTGW&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e"> description</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TGW to connect to Spoke VPC&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e"> default_route_table_association</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;disable&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e"> default_route_table_propagation</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;disable&#34;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Create TGW Route Tables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route_table&#34;</span> <span style="color:#e6db74">&#34;RT-Egrees&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route_table&#34;</span> <span style="color:#e6db74">&#34;RT-Private&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Create TGW attachment for Prod-Hub VPC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_vpc_attachment&#34;</span> <span style="color:#e6db74">&#34;prod-hub&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_ids</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_default_route_table_association</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_default_route_table_propagation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Create TGW attachment for Spoke-01 VPC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_vpc_attachment&#34;</span> <span style="color:#e6db74">&#34;spoke-01&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_ids</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_default_route_table_association</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_default_route_table_propagation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Create TGW attachment for Spoke-02 VPC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_vpc_attachment&#34;</span> <span style="color:#e6db74">&#34;spoke-02&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_ids</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_default_route_table_association</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_default_route_table_propagation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Routing tables to route traffic for Public Subnet in Prod-Hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;prod-hub-public&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span>        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-public-route-table&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Environment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Routing tables to route traffic for Private Subnet- Prod Hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;prod-hub-private&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">prod_hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span>        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-private-route-table&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Environment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">prod_environment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Routing tables to route traffic for Private Subnet- Spoke-01
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;spoke-01-private&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span>        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_01_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-private-route-table&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Environment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_01_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Routing tables to route traffic for Private Subnet- Spoke-02
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;spoke-02-private&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">vpc_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Name</span>        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_02_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-private-route-table&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">Environment</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">spoke_02_environmet</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Route for Internet Gateway in Prod-Hub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;public_internet_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">public</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_internet_gateway</span>.<span style="color:#a6e22e">IGW_ProdHub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Route for NAT Gateway - Prodhub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;private_prod_nat_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">nat_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_nat_gateway</span>.<span style="color:#a6e22e">Prod_HubNAT</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;private_prod_spoke01_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.14.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;private_prod_spoke02_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.15.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Route for NAT Gateway - Spoke-01
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;private_spoke01_nat_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Route for NAT Gateway - Spoke-02
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route&#34;</span> <span style="color:#e6db74">&#34;private_spoke02_nat_gateway&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">route_table_id</span>         <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">transit_gateway_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway</span>.<span style="color:#a6e22e">ProdHub_EgressTGW</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Route for Egress TGW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route&#34;</span> <span style="color:#e6db74">&#34;RT_Egress01&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.14.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_route_table_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_route_table</span>.<span style="color:#a6e22e">RT</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Egrees</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_attachment_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_vpc_attachment</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Route for Egress TGW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route&#34;</span> <span style="color:#e6db74">&#34;RT_Egress02&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.15.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_route_table_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_route_table</span>.<span style="color:#a6e22e">RT</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Egrees</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_attachment_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_vpc_attachment</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Route for RT-Private TGW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route&#34;</span> <span style="color:#e6db74">&#34;RT_Private_Blackhole&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.15.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_route_table_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_route_table</span>.<span style="color:#a6e22e">RT</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">blackhole</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route&#34;</span> <span style="color:#e6db74">&#34;RT_PrivateSPOKE_blackhole&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.14.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_route_table_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_route_table</span>.<span style="color:#a6e22e">RT</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">blackhole</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ec2_transit_gateway_route&#34;</span> <span style="color:#e6db74">&#34;RT_Private_Allow&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">destination_cidr_block</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.13.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_route_table_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_route_table</span>.<span style="color:#a6e22e">RT</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">transit_gateway_attachment_id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">aws_ec2_transit_gateway_vpc_attachment</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#Create ec2 instances in Prod,Spoke-01/02 to test the egress architecture
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;prod-t2&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">ami</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-04e914639d0cca79a&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">instance_type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">prod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hub</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">associate_public_ip_address</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">key_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;terraform-key&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;spoke-01-t2&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">ami</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-04e914639d0cca79a&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">instance_type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-01</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">associate_public_ip_address</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">key_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;terraform-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_instance&#34;</span> <span style="color:#e6db74">&#34;spoke-02-t2&#34;</span> {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">ami</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ami-04e914639d0cca79a&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">instance_type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;t2.micro&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">subnet_id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">spoke</span><span style="color:#ae81ff">-02</span><span style="color:#f92672">-</span><span style="color:#a6e22e">private</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">associate_public_ip_address</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">key_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;terraform-key&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://akamalsha.github.io/en/tags/cloud/">Cloud</a></li>
      <li><a href="https://akamalsha.github.io/en/tags/automation/">Automation</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://akamalsha.github.io/en/blog/pan_cve2024/">
    <span class="title">« Prev</span>
    <br>
    <span>Palo Alto Networks CVE 2024</span>
  </a>
  <a class="next" href="https://akamalsha.github.io/en/blog/windows/">
    <span class="title">Next »</span>
    <br>
    <span>Windows Server Configuration</span>
  </a>
</nav>

  </footer>
</article>
    </main>
      
<script id="partials/analytics.html" 
  data-goatcounter="https://akamalsha.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>



<footer class="footer">
    <span>&copy; 2025 <a href="https://akamalsha.github.io/en/">Adil Kamalsha&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
